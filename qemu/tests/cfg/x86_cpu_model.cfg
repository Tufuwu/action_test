- x86_cpu_model:
    type = x86_cpu_model
    cpu_model_flags += ",enforce"
    auto_cpu_model = no
    kill_vm_on_error = yes
    start_vm = no
    reboot_method = "shell"
    only i386, x86_64
    Windows:
        get_model_cmd = "wmic cpu get name"
    Linux:
        get_model_cmd = "lscpu | grep 'Model name'"
    variants model:
        - host:
            type = boot
            cpu_model = host
            start_vm = yes
            cpu_model_flags += ",check"
        - max:
            type = boot
            cpu_model = max
            start_vm = yes
            cpu_model_flags += ",check"
        - EPYC-Milan:
            only HostCpuVendor.amd
            flags = "movbe rdrand rdtscp fxsr_opt cr8_legacy osvw fsgsbase bmi1 avx2 smep bmi2 rdseed adx smap clflushopt sha_ni xsaveopt xsavec xgetbv1 arat f16c xsaveerptr clzero rdpid perfctr_core ibpb wbnoinvd stibp clwb umip xsaves pcid ibrs ssbd erms fsrm invpcid pku"
            model_pattern = "AMD EPYC-Milan Processor%s"
        - EPYC-Rome:
            only HostCpuVendor.amd
            flags = "movbe rdrand rdtscp fxsr_opt cr8_legacy osvw fsgsbase bmi1 avx2 smep bmi2 rdseed adx smap clflushopt sha_ni xsaveopt xsavec xgetbv1 arat f16c xsaveerptr clzero rdpid perfctr_core ibpb wbnoinvd stibp clwb umip xsaves"
            model_pattern = "AMD EPYC-Rome Processor%s"
        - EPYC:
            only HostCpuVendor.amd
            flags = "movbe rdrand rdtscp fxsr_opt cr8_legacy osvw fsgsbase bmi1 avx2 smep bmi2 rdseed adx smap clflushopt sha_ni xsaveopt xsavec xgetbv1 arat f16c"
            model_pattern = "AMD EPYC Processor%s"
        - Opteron_G5:
            only HostCpuVendor.amd
            flags = "vme sse2 sse fxsr mmx clflush pse36 pat cmov mca pge mtrr sep apic cx8 mce pae msr tsc pse de f16c avx xsave aes popcnt sse4_2 sse4_1 cx16 fma ssse3 pclmulqdq lm pdpe1gb nx syscall tbm fma4 xop 3dnowprefetch misalignsse sse4a abm lahf_lm fpu"
            model_pattern = "AMD Opteron 63xx class CPU%s"
        - Opteron_G4:
            only HostCpuVendor.amd
            flags = "vme sse2 sse fxsr mmx clflush pse36 pat cmov mca pge mtrr sep apic cx8 mce pae msr tsc pse de  avx xsave aes popcnt sse4_2 sse4_1 cx16 ssse3 pclmulqdq lm pdpe1gb nx syscall fma4 xop 3dnowprefetch misalignsse sse4a abm lahf_lm fpu"
            model_pattern = "AMD Opteron 62xx class CPU%s"
        - Opteron_G3:
            only HostCpuVendor.amd
            flags = "vme sse2 sse fxsr mmx clflush pse36 pat cmov mca pge mtrr sep apic cx8 mce pae msr tsc pse de  popcnt cx16 lm nx syscall misalignsse sse4a abm lahf_lm fpu"
            model_pattern = "AMD Opteron 23xx \(Gen 3 Class Opteron%s\)"
        - Snowridge:
            only HostCpuVendor.intel
            flags = "split_lock_detect gfni movdiri movdiri64b cldemote umip"
            model_pattern = "Intel Atom Processor \(SnowRidge%s\)"
        - Cooperlake:
            only HostCpuVendor.intel
            # support 'BFloat16' with RHEL8.2 guest or later
            no RHEL.6 RHEL.7 RHEL.8.0 RHEL.8.1
            flags = "avx512_bf16 stibp arch_capabilities"
            model_pattern = "Intel Xeon Processor \(Cooperlake%s\)"
            check_cmd = "cat /sys/devices/system/cpu/vulnerabilities/%s"
            vulnerabilities = "ls /sys/devices/system/cpu/vulnerabilities/"
            check_items = "itlb_multihit mds tsx_async"
            expect_result = 'Not affected'
        - Icelake-Server:
            only HostCpuVendor.intel
            flags = "la57 wbnoinvd avx512vbmi umip avx512_vbmi2 gfni vaes vpclmulqdq avx512_bitalg avx512_vpopcntdq clflushopt pdpe1gb clwb avx512f avx512dq avx512bw avx512cd avx512vl"
            model_pattern = "Intel Xeon Processor \(Icelake%s\)"
        - Icelake-Server-noTSX:
            only HostCpuVendor.intel
            flags = "la57 wbnoinvd avx512vbmi umip avx512_vbmi2 gfni vaes vpclmulqdq avx512_bitalg avx512_vpopcntdq clflushopt pdpe1gb clwb avx512f avx512dq avx512bw avx512cd avx512vl"
            model_pattern = "Intel Xeon Processor \(Icelake%s\)"
            no_flags = "hle rtm"
        - Icelake-Client:
            only HostCpuVendor.intel
            required_qemu = (, 5.2.0)
            flags = "wbnoinvd avx512vbmi umip avx512_vbmi2 gfni vaes vpclmulqdq avx512_bitalg avx512_vpopcntdq"
            model_pattern = "Intel Core Processor \(Icelake%s\)"
        - Icelake-Client-noTSX:
            only HostCpuVendor.intel
            required_qemu = (, 5.2.0)
            flags = "wbnoinvd avx512vbmi umip avx512_vbmi2 gfni vaes vpclmulqdq avx512_bitalg avx512_vpopcntdq"
            model_pattern = "Intel Core Processor \(Icelake%s\)"
            no_flags = "hle rtm"
        - Cascadelake-Server:
            only HostCpuVendor.intel
            flags = "avx512_vnni clflushopt ibrs ibpb pdpe1gb clwb avx512f avx512dq avx512bw avx512cd avx512vl"
            model_pattern = "Intel Xeon Processor \(Cascadelake%s\)"
        - Cascadelake-Server-noTSX:
            only HostCpuVendor.intel
            flags = "avx512_vnni clflushopt ibrs ibpb pdpe1gb clwb avx512f avx512dq avx512bw avx512cd avx512vl"
            model_pattern = "Intel Xeon Processor \(Cascadelake%s\)"
            no_flags = "hle rtm"
        - Skylake-Server:
            only HostCpuVendor.intel
            flags = "pdpe1gb clwb avx512f avx512dq avx512bw avx512cd avx512vl"
            model_pattern = "Intel Xeon Processor \(Skylake%s\)"
        - Skylake-Server-noTSX:
            only HostCpuVendor.intel
            flags = "pdpe1gb clwb avx512f avx512dq avx512bw avx512cd avx512vl"
            model_pattern = "Intel Xeon Processor \(Skylake%s(, no TSX)?\)"
            no_flags = "hle rtm"
        - Skylake-Client:
            only HostCpuVendor.intel
            flags = "xsavec xgetbv1"
            model_pattern = "Intel Core Processor \(Skylake%s\)"
        - Skylake-Client-noTSX:
            only HostCpuVendor.intel
            flags = "xsavec xgetbv1"
            model_pattern = "Intel Core Processor \(Skylake%s(, no TSX)?\)"
            no_flags = "hle rtm"
        - Broadwell:
            only HostCpuVendor.intel
            flags = "adx rdseed 3dnowprefetch smap hle rtm"
            model_pattern = "Intel Core Processor \(Broadwell%s\)"
        - Broadwell-noTSX:
            only HostCpuVendor.intel
            flags = "adx rdseed 3dnowprefetch smap"
            model_pattern = "Intel Core Processor \(Broadwell, no TSX%s\)"
            no_flags = "hle rtm"
        - Haswell:
            only HostCpuVendor.intel
            flags = "vme sse2 sse fxsr mmx clflush pse36 pat cmov mca pge mtrr sep apic cx8 mce pae msr tsc pse de fpu avx xsave aes tsc_deadline_timer fma movbe popcnt x2apic sse4_2 sse4_1 cx16 ssse3 pclmulqdq pni f16c rdrand fsgsbase bmi1 hle avx2 smep bmi2 erms invpcid rtm lm rdtscp nx syscall lahf_lm xsaveopt arat pcid"
            model_pattern = "Intel Core Processor \(Haswell%s\)"
        - Haswell-noTSX:
            only HostCpuVendor.intel
            flags = "vme sse2 sse fxsr mmx clflush pse36 pat cmov mca pge mtrr sep apic cx8 mce pae msr tsc pse de fpu avx xsave aes tsc_deadline_timer fma movbe popcnt x2apic sse4_2 sse4_1 cx16 ssse3 pclmulqdq pni f16c rdrand fsgsbase bmi1 avx2 smep bmi2 erms invpcid lm rdtscp nx syscall lahf_lm xsaveopt arat pcid"
            model_pattern = "Intel Core Processor \(Haswell, no TSX%s\)"
            no_flags = "hle rtm"
        - IvyBridge:
            only HostCpuVendor.intel
            flags = "vme sse2 sse fxsr mmx clflush pse36 pat cmov mca pge mtrr sep apic cx8 mce pae msr tsc pse de fpu avx xsave aes tsc_deadline_timer popcnt x2apic sse4_2 sse4_1 cx16 ssse3 pclmulqdq pni rdrand fsgsbase smep erms lm rdtscp nx syscall lahf_lm xsaveopt arat f16c"
            model_pattern = "Intel Xeon E3-12xx v2 \(Ivy Bridge%s\)"
        - SandyBridge:
            only HostCpuVendor.intel
            flags = "vme sse2 sse fxsr mmx clflush pse36 pat cmov mca pge mtrr sep apic cx8 mce pae msr tsc pse de fpu avx xsave aes tsc_deadline_timer popcnt x2apic sse4_2 sse4_1 cx16 ssse3 pclmulqdq pni lm rdtscp nx syscall lahf_lm xsaveopt arat"
            model_pattern = "Intel Xeon E312xx \(Sandy Bridge%s\)"
